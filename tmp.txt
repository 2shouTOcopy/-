// CIndustRecogModule.cpp

int CIndustRecogModule::BuildAllPublishParamList()
{
    // 1. 清空聚合列表
    memset(&m_stAllPublishParamList, 0, sizeof(m_stAllPublishParamList));

    // 2. 先取静态发布参数
    DYNAMIC_PUBLISH_PARAM_LIST stStaticList;
    memset(&stStaticList, 0, sizeof(stStaticList));

    int nErrCode = staticSubPub.GetDynamicPubParam(&stStaticList);
    if (IMVS_EC_OK != nErrCode)
    {
        LOGE("staticSubPub.GetDynamicPubParam failed, %d\n", nErrCode);
        return nErrCode;
    }

    // 3. 触发动态更新并获取动态数量
    int nDynamicNum = m_subModuleManager.GetDynamicPublishParamNum();
    // 注意：GetDynamicPublishParamNum 内部已经日志+失败返回0

    // 4. 合并：静态在前，动态在后
    const int nStaticNum = stStaticList.nNum;

    // 防止数组越界（假设 pubParamList 固定数组）
    const int nMax =
        (int)(sizeof(m_stAllPublishParamList.pubParamList) / sizeof(m_stAllPublishParamList.pubParamList[0]));

    int nWrite = 0;

    // 4.1 拷贝静态
    for (int i = 0; i < nStaticNum && nWrite < nMax; ++i)
    {
        m_stAllPublishParamList.pubParamList[nWrite++] = stStaticList.pubParamList[i];
    }

    // 4.2 拷贝动态
    for (int i = 0; i < nDynamicNum && nWrite < nMax; ++i)
    {
        DYNAMIC_PUBLISH_PARAM stParam;
        memset(&stParam, 0, sizeof(stParam));

        int ret = m_subModuleManager.GetDynamicSinglePublishParam(i, &stParam);
        if (IMVS_EC_OK != ret)
        {
            LOGE("GetDynamicSinglePublishParam failed, idx=%d, ret=%d\n", i, ret);
            // 动态部分有问题时，这里选择“跳过该项继续”
            continue;
        }

        m_stAllPublishParamList.pubParamList[nWrite++] = stParam;
    }

    m_stAllPublishParamList.nNum = nWrite;

    LOGI("BuildAllPublishParamList ok, static=%d, dynamic=%d, total=%d\n",
         nStaticNum, nDynamicNum, m_stAllPublishParamList.nNum);

    return IMVS_EC_OK;
}

int CIndustRecogModule::GetDynamicPublishParamNum()
{
    int nErrCode = BuildAllPublishParamList();
    if (IMVS_EC_OK != nErrCode)
    {
        LOGE("BuildAllPublishParamList failed, %d\n", nErrCode);
        return 0;
    }

    LOGI("GetDynamicPublishParamNum (static+dynamic) is %d\r\n", m_stAllPublishParamList.nNum);
    return m_stAllPublishParamList.nNum;
}

int CIndustRecogModule::GetDynamicSinglePublishParam(IN int nParamIdx,
                                                     OUT DYNAMIC_PUBLISH_PARAM* pstPublishParam)
{
    if (pstPublishParam == NULL)
    {
        return IMVS_EC_PARAM;
    }

    int nErrCode = BuildAllPublishParamList();
    if (IMVS_EC_OK != nErrCode)
    {
        LOGE("BuildAllPublishParamList failed, %d\n", nErrCode);
        return nErrCode;
    }

    if (nParamIdx < 0 || nParamIdx >= m_stAllPublishParamList.nNum)
    {
        return IMVS_EC_PARAM_NOT_VALID;
    }

    memcpy(pstPublishParam, &m_stAllPublishParamList.pubParamList[nParamIdx],
           sizeof(DYNAMIC_PUBLISH_PARAM));

    LOGI("nParamIdx %d: pub(param_name[%s],type:%s))\r\n", nParamIdx,
         m_stAllPublishParamList.pubParamList[nParamIdx].szName,
         m_stAllPublishParamList.pubParamList[nParamIdx].szType);

    return IMVS_EC_OK;
}